<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.diligrp.xtrade.user.dao.IUserCardRepositoryDao">
	
	<select id="selectForPage" resultType="com.diligrp.xtrade.user.domain.entity.UserCardRepositoryEntity"
	parameterType="com.diligrp.xtrade.user.domain.dto.CardRepoQueryParam">
		SELECT
			`id`, 
			`device_id`, 
			`card_no`, 
			`category`, 
			`verify_code`, 
			`institution_code`, 
			`maker_version`, 
			`status`, 
			`market_id`, 
			`remark`, 
			`creater_name`, 
			`created_time`, 
			`modified_time`
		FROM
			user_card_repository
		WHERE
			1 = 1
		<if
			test="cardNo != null"><![CDATA[ AND card_no = #{cardNo}]]></if>
		<if
			test="startIndex != null and startIndex &gt;= 0 and pageSize != null and pageSize &gt; 0"><![CDATA[LIMIT #{startIndex},#{pageSize}]]></if>
	</select>
	
	<select id="selectForPageCount"  parameterType="com.diligrp.xtrade.user.domain.dto.CardRepoQueryParam" resultType="java.lang.Long">
		SELECT
			count(`id`)
		FROM
			user_card_repository
		WHERE
			1 = 1
		<if
			test="cardNo != null"><![CDATA[ AND card_no = #{cardNo}]]></if>
	</select>
	
	<insert id="save">
		INSERT INTO user_card_repository (
			`device_id`, 
			`card_no`, 
			`category`, 
			`verify_code`, 
			`institution_code`, 
			`maker_version`, 
			`status`, 
			`market_id`, 
			`remark`, 
			`creater_name`, 
			`created_time`, 
			`modified_time`
		)
		VALUES (
			#{deviceId}, 
			#{cardNo}, 
			#{category}, 
			#{verifyCode}, 
			#{institutionCode}, 
			#{makerVersion}, 
			#{status}, 
			#{marketId}, 
			#{remark}, 
			#{createrName}, 
			#{createdTime}, 
			#{modifiedTime}
		)
	</insert>
	
	<select id="getByCardNo" resultType="com.diligrp.xtrade.user.domain.entity.UserCardRepositoryEntity">
		SELECT
			`id`, 
			`device_id`, 
			`card_no`, 
			`category`, 
			`verify_code`, 
			`institution_code`, 
			`maker_version`, 
			`status`, 
			`market_id`, 
			`remark`, 
			`creater_name`, 
			`created_time`, 
			`modified_time`
		FROM
			user_card_repository
		WHERE
			card_no = #{cardNo}
	</select>
	
	<update id="updateByCardNo">
		UPDATE user_card_repository
	 	<set>
			<if test="deviceId != null">`device_id` = #{deviceId}, </if>
			<if test="category != null">`category` = #{category}, </if>
			<if test="verifyCode != null">`verify_code` = #{verifyCode}, </if>
			<if test="institutionCode != null">`institution_code` = #{institutionCode}, </if>
			<if test="makerVersion != null">`maker_version` = #{makerVersion}, </if>
			<if test="status != null">`status` = #{status}, </if>
			<if test="marketId != null">`market_id` = #{marketId}, </if>
			<if test="remark != null">`remark` = #{remark}, </if>
			<if test="createrName != null">`creater_name` = #{createrName}, </if>
			<if test="modifiedTime != null">`modified_time` = #{modifiedTime}</if>
		</set>
		WHERE
			card_no = #{cardNo}
	</update>
	
	<delete id="batchRemove">
		DELETE
		FROM
			user_card_repository
		WHERE
			id IN
		<foreach item="id" collection="array" open="(" separator="," close=")">
			#{id}
		</foreach>
	</delete>

</mapper>