<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper
	namespace="com.diligrp.xtrade.user.dao.IUserAccountCardDao">

	<select id="selectList"
		resultType="com.diligrp.xtrade.user.domain.dto.UserAccountCardDto"
		parameterType="com.diligrp.xtrade.user.domain.dto.UserAccountCardQuery">
		SELECT
			ui.id userInfoId,
			ui.name,
			ui.custormer_type,
			ui.credential_no,
			ui.mobile,
			ua.biz_usage_type,
			ua.id as accountId,
			ua.use_permission,
			ua.fund_account_id,
			ua.parent_account_id,
			uc.id cardId,
			uc.card_no,
			uc.system_disable_status,
			uc.`status`
		FROM
			user_account ua
		INNER JOIN
			user_info ui ON ui.id = ua.user_info_id
		INNER JOIN
			user_card uc ON uc.account_id = ua.id
		WHERE
			uc.status != 4
		<if test="mobile != null"> AND ui.`mobile` = #{mobile}</if>
		<if test="name != null"> AND ui.`name` = #{name}</if>
		<if test="credentialNo != null"> AND ui.`credential_no` = #{credentialNo}</if>
		<if test="crmCustormerId != null"> AND ua.`crm_custormer_id` = #{crmCustormerId}</if>
		<if test="usePermission != null"> AND ua.`use_permission` LIKE "%"#{usePermission}"%"</if>
		<if test="parentAccountId != null"> AND ua.parent_account_id = #{parentAccountId} </if>
		<if test="exclusionsCardCategorys != null and exclusionsCardCategorys.size > 0">
			AND uc.category NOT IN
			<foreach collection="exclusionsCardCategorys" item="category"
				open="(" separator="," close=")">
				#{category}
			</foreach>
		</if>
		<if test="cardCategorys != null and cardCategorys.size > 0">
			AND uc.category IN
			<foreach collection="cardCategorys"
				item="category" open="(" separator="," close=")">
				#{category}
			</foreach>
		</if>
		<if test="accountIds != null and accountIds.size > 0">
			AND ua.id IN
			<foreach collection="accountIds"
				item="accountId" open="(" separator="," close=")">
				#{accountId}
			</foreach>
		</if>
		<if test="cardNos != null and cardNos.size > 0">
			AND uc.card_no IN
			<foreach collection="cardNos"
				item="cardNo" open="(" separator="," close=")">
				#{cardNo}
			</foreach>
		</if>
	</select>

	<select id="getOnly"
		resultType="com.diligrp.xtrade.user.domain.dto.UserAccountCardDto"
		parameterType="com.diligrp.xtrade.user.domain.dto.UserAccountCardQuery">
		SELECT
			ui.id userInfoId,
			ui.name,
			ui.custormer_type,
			ui.credential_no,
			ui.mobile,
			ui.auth_status,
			ua.biz_usage_type,
			ua.id as accountId,
			ua.use_permission,
			ua.fund_account_id,
			ua.parent_account_id,
			ua.login_pwd,
			ua.market_id,
			uc.id cardId,
			uc.system_disable_status,
			uc.card_no,
			uc.category,
			uc.`status`
		FROM
			user_account ua
		INNER JOIN
			user_info ui ON ui.id = ua.user_info_id
		INNER JOIN
			user_card uc ON uc.account_id = ua.id
		WHERE
			uc.status != 4
		<if test="cardNo != null"> AND uc.`card_no` = #{cardNo}</if>
		<if test="accountId != null"> AND ua.`id` = #{accountId}</if>
	</select>
</mapper>